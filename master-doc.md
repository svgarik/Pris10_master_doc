## Дизайн ML системы - \<Продукт\> \<MVP or Production System\> \<Номер\>

### 1. Цели и предпосылки 
#### 1.1. Зачем идем в разработку продукта?  

Бизнес-цель:
 - Автоматизировать анализ тональности пользовательских комментариев в соцсети, чтобы:

 - Оперативно выявлять негатив и потенциально неприемлемый контент.

 - Снизить нагрузку на модераторов за счет автоматической фильтрации.

 - Уменьшить риски штрафов от РКН за недостаточную модерацию.

 - Повысить вовлеченность аудитории за счет своевременной реакции на обратную связь.

Почему станет лучше, чем сейчас:

 - Скорость: ML-модель сможет обрабатывать до 500K комментариев в день в реальном времени, в отличие от выборочного ручного анализа.

 - Объективность: Исключается субъективность модераторов, модель оценивает тональность на основе данных.

 - Масштабируемость: Решение легко адаптируется под рост нагрузки.

 - Снижение затрат: Уменьшение ручного труда сократит операционные издержки.

 - [Модель бизнес процесса до внедрения системы](https://github.com/svgarik/Pris10_master_doc/blob/main/graphs/Диаграмма%20до.drawio.png)

 - [Модель бизнес процесса после внедрения системы](https://github.com/svgarik/Pris10_master_doc/blob/main/graphs/Диаграмма%20после.drawio.png)

Что будем считать успехом итерации:

 - Модель корректно классифицирует 85%+ комментариев (точность).

 - Снижение времени модерации на 30%.

 - Выявление 90%+ нарушающих правил комментариев (полнота).

 - Интеграция в текущий процесс модерации без критических сбоев.

#### 1.2. Бизнес-требования и ограничения  

Бизнес-требования:

Основные:

- Автоматическая классификация комментариев на: негативные, нейтральные, позитивные, нарушающие правила.

- Реал-тайм обработка (задержка < 1 сек. на комментарий).

- Интеграция с текущей системой модерации (API или прямое подключение к БД).

Бизнес-ограничения:

- Ресурсы: Ограниченный бюджет на разработку и внедрение.

- Время: Пилот должен быть запущен через 3 месяца.

- Регуляторика: Модель должна учитывать требования РКН к контенту.

Ожидания от итерации:

- Рабочий прототип, интегрированный в тестовую среду.

- Демонстрация эффективности на исторических данных.

- Подготовка к масштабированию.

Описание бизнес-процесса пилота:

- Комментарии поступают в систему → ML-модель классифицирует их.

- Подозрительные комментарии отправляются на проверку модераторам.

- Остальные автоматически одобряются/отклоняются.

- Модераторы могут корректировать решения модели (обратная связь для дообучения).

Критерии успешного пилота:

- Достижение целевых метрик (точность, скорость).

- Положительный фидбек от модераторов.

- Готовность к промышленному внедрению.

- Возможные пути развития:

- Добавление мультиязычности.

- Анализ эмоций (злость, сарказм и т. д.).

- Интеграция с другими платформами.

#### 1.3. Что входит в скоуп проекта/итерации, что не входит   

На закрытие каких БТ подписываемся:

- Разработка и обучение модели классификации тональности.

- Интеграция с тестовым контуром модерации.

- Документация по API и работе модели.

Что не будет закрыто:

- Полная автоматизация модерации (останется ручная проверка части комментариев).

- Поддержка редких языков (только русский на первой итерации).

- Анализ изображений/видео в комментариях.

Результат с точки зрения качества кода:

- Чистый, модульный код с тестами (покрытие >80%).

- Воспроизводимость: Docker-контейнер с моделью и инструкции по развертыванию.

Технический долг:

- Оптимизация скорости инференса для больших объемов.

- Улучшение обработки сленга и опечаток.

- Расширение датасета для редких кейсов.

#### 1.4. Предпосылки решения  

Общие предпосылки (Data Scientist):

Данные:

- Используем исторические данные модерации (разметка: "нарушает правила"/"нет").

- Дополнительные источники: открытые датасеты (например, RuSentiment).

- Горизонт прогноза: Реал-тайм (обработка в момент появления комментария).

- Гранулярность: Один комментарий → одна метка тональности.

Метрики:

- Precision/Recall для выявления нарушений.

- F1-score для баланса.

Стек: Python (PyTorch/TensorFlow), FastAPI, Kubernetes (для масштабирования).

Обоснование:

- Выбор ML (а не правила) из-за сложности контекстного анализа.

- Реал-тайм обработка критична для модерации.

- Русский язык — приоритет из-за требований РКН


#### 2.1. Постановка задачи  
* Тип задачи
    - Задача классификации тональности (Sentiment Analysis) с элементами обнаружения аномалий.

    - Основная подзадача: Многоклассовая классификация (негатив/нейтраль/позитив) + бинарная классификация (нарушает правила/нет).

    - Дополнительная подзадача: Поиск аномалий (выявление скрыто агрессивных, саркастичных или манипулятивных комментариев).

* Архитектура решения
    - Data Pipeline

    - Источники данных:

        - Поток комментариев из соцсети (Kafka/API).

        - Размеченные исторические данные модерации.

        - Открытые датасеты (RuSentiment, Kaggle).

    - Предобработка:

        - Очистка текста (удаление стоп-слов, эмодзи, нормализация).

        - Векторизация (TF-IDF, Word2Vec, BERT-эмбеддинги).

        - Моделирование

    - Базовый подход:

        - BERT/RuBERT (fine-tuning для тональности и модерации).

        - Дополнительно: CatBoost/XGBoost на TF-IDF для быстрого прототипирования.

    - Обнаружение аномалий:

        - Isolation Forest или автоэнкодеры для выявления неочевидных нарушений.

    - Оптимизация:

        - Квантование модели (для ускорения инференса).

        - Кэширование частых запросов (например, мемов/шаблонных фраз).

    - Интеграция

        - API (FastAPI/Flask): Принимает текст комментария → возвращает метку и скор.

        - Стриминг: Интеграция с Kafka для обработки в реальном времени.

        - Фидбек-петля: Корректировки модераторов → дообучение модели.

* Критические технологии
    - Языковые модели: RuBERT, GPT-3.5 (для контекстного анализа).

    - Фреймворки: PyTorch, Hugging Face Transformers.

    - Инфраструктура: Kubernetes (оркестрация), Prometheus (мониторинг).

* Метрики качества
    - Для классификации:

        - Precision/Recall/F1 (особенно для класса "нарушения").

        - AUC-ROC (для бинарной классификации).

    - Для аномалий:

        - Процент выявленных "скрытых" нарушений.

    - Системные:

        - Задержка обработки (<1 сек).

        - Пропускная способность (500K/день).

* Что не входит в текущий скоуп
    - Динамическое обучение (online learning): Пока планируется периодическое дообучение.

    - Мультимодальность: Анализ изображений/видео в комментариях.

    - Глубокая интерпретация: Explainable AI (LIME/SHAP) — только базовые feature importance.

* Риски и пути их mitigation
    - Риск: Низкое качество на сленге/опечатках.

    - Решение: Досбор датасета с мемами и разговорной речью.

    - Риск: Задержки при масштабировании.

    - Решение: Оптимизация через ONNX Runtime.
